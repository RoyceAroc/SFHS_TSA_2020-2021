<!DOCTYPE html>
<html lang="en">
<head>
<title> Login </title>
<meta name="google-signin-scope" content="profile email">
    	<meta name="google-signin-client_id" content="1053340133011-2hj9da3fm8vtkj4con2sggl65cabj9mp.apps.googleusercontent.com">
   		<script src="https://apis.google.com/js/platform.js" async defer></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css'>
<link rel='stylesheet' type="text/css" href="styles/login.css">
</head>
<body translate="no">
<div class="logmod">
<div class="logmod__wrapper">
<span class="logmod__close">Close</span>
<div class="logmod__container">
<ul class="logmod__tabs">
<li data-tabtar="lgm-2"><a href="#">Login</a></li>
<li data-tabtar="lgm-1"><a href="#">Sign Up</a></li>
</ul>
<div class="logmod__tab-wrapper">
<div class="logmod__tab lgm-1">
<div class="logmod__heading">
<span class="logmod__heading-subtitle">Enter your personal details <strong>to create an account</strong></span>
</div>
<div class="logmod__form">
<form accept-charset="utf-8"  class="simform">
<div class="sminputs">
<div class="input full">
<label class="string optional" for="user-name">Email*</label>
<input class="string optional" maxlength="255" id="user-email" placeholder="Email" type="email" size="50" />
</div>
</div>
<div class="sminputs">
<div class="input string optional">
<label class="string optional" for="user-pw">Password *</label>
<input class="string optional" maxlength="255" id="user-pw" placeholder="Password" type="text" size="50" />
</div>
<div class="input string optional">
<label class="string optional" for="user-pw-repeat">Repeat password *</label>
<input class="string optional" maxlength="255" id="user-pw-repeat" placeholder="Repeat password" type="text" size="50" />
</div>
</div>
<div class="simform__actions">
<input onclick="register()" class="sumbit" type="sumbit" value="Create Account" />
<span class="simform__actions-sidetext">By creating an account you agree to our <a class="special" href="#" target="_blank" role="link">Terms & Privacy</a></span>
</div>
</form>
</div>
<div class="logmod__alter">
<div class="logmod__alter-container">
<a href="#" class="connect facebook">
<div class="connect__icon">
<i class="fa fa-facebook"></i>
</div>
<div class="connect__context">
	<header  style="opacity:0;">
<div style="position: absolute; top:0px; left:0;z-index: 100000;" class="fb-login-button" onlogin="checkLoginState();" data-max-rows="2" data-size="large" data-width="1010"   data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">dsf</div>
<div style="position: absolute; top:-30px; left:0;z-index: 100000;" class="fb-login-button" onlogin="checkLoginState();" data-max-rows="2" data-size="large" data-width="1010"   data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">dsf</div>
<div style="position: absolute; top:-30px; left:200px;z-index: 100000;" class="fb-login-button" onlogin="checkLoginState();" data-max-rows="2" data-size="large" data-width="1010"   data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">dsf</div>
<div style="position: absolute; top:0px; left:200px;z-index: 100000;" class="fb-login-button" onlogin="checkLoginState();" data-max-rows="2" data-size="large" data-width="1010"   data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">dsf</div>
<div style="position: absolute; top:-28px; left:200px;z-index: 100000;" class="fb-login-button" onlogin="checkLoginState();" data-max-rows="2" data-size="large" data-width="1010"   data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">dsf</div>
</header>
<span>Create an account with <strong>Facebook</strong></span>
</div>
</a>
<a href="#" class="connect googleplus">
<div class="connect__icon">
<i class="fa fa-google-plus"></i>
</div>
<div class="connect__context">
	<div style="position: absolute; width: 1000px; height: 500px; z-index: 10000; opacity:0;" class="g-signin2" data-onsuccess="onSignIn" data-onfailure="onSignInFailure" data-theme="dark"></div>
<span>Create an account with <strong>Google</strong></span>
</div>

</a>
</div>
</div>
</div>
<div class="logmod__tab lgm-2">
<div class="logmod__heading">
<span class="logmod__heading-subtitle">Enter your email and password <strong>to sign in</strong></span>
</div>
<div class="logmod__form">
<form accept-charset="utf-8" class="simform">
<div class="sminputs">
<div class="input full">
<label class="string optional" for="user-name">Email*</label>
<input class="string optional" maxlength="255" id="user-email1" placeholder="Email" type="email" size="50" />
</div>
</div>
<div class="sminputs">
<div class="input full">
<label class="string optional" for="user-pw">Password *</label>
<input class="string optional" maxlength="255" id="user-pw1" placeholder="Password" type="password" size="50" />
<span class="hide-password">Show</span>
</div>
</div>
<div class="simform__actions">
<input class="sumbit" onclick="log()" type="sumbit" value="Log In" />
<span class="simform__actions-sidetext"><a class="special" role="link" href="#">Forgot your password?</a></span>
 
</div>
</form>
</div>
<div class="logmod__alter">
<div class="logmod__alter-container">
<div class="connect facebook">
<div class="connect__icon">
<i class="fa fa-facebook"></i>
</div>
<div  class="connect__context">
	
<!--	<fb:login-button style="width: 549px !important;"
  scope="public_profile,email"
  onlogin="checkLoginState();"/>
-->
<header style="opacity:0;">
	<base target="_top">
<div target="_top" style="position: absolute; top:0px; left:0;z-index: 100000;" class="fb-login-button" onlogin="checkLoginState();" data-max-rows="2" data-size="large" data-width="1010"   data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">dsf</div>
<div style="position: absolute; top:-30px; left:0;z-index: 100000;" class="fb-login-button" onlogin="checkLoginState();" data-max-rows="2" data-size="large" data-width="1010"   data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">dsf</div>
<div style="position: absolute; top:-30px; left:200px;z-index: 100000;" class="fb-login-button" onlogin="checkLoginState();" data-max-rows="2" data-size="large" data-width="1010"   data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">dsf</div>
<div style="position: absolute; top:0px; left:200px;z-index: 100000;" class="fb-login-button" onlogin="checkLoginState();" data-max-rows="2" data-size="large" data-width="1010"   data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">dsf</div>
<div style="position: absolute; top:-28px; left:200px;z-index: 100000;" class="fb-login-button" onlogin="checkLoginState();" data-max-rows="2" data-size="large" data-width="1010"   data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">dsf</div>
</base>
</header>
<span >Sign in with <strong>Facebook</strong></span>

</div>
</div>
<a href="#" class="connect googleplus">
<div class="connect__icon">
<i class="fa fa-google-plus"></i>
</div>
<div  class="connect__context">
	<div style="position: absolute; width: 1000px; height: 500px; z-index: 10000; opacity:0;" class="g-signin2" data-onsuccess="onSignIn" data-onfailure="onSignInFailure" data-theme="dark"></div>
<span>Sign in with <strong>Google+</strong></span>

</div>
</a>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script>
	function log() {
		let email_a = document.getElementById("user-email1").value;
		let pwd_b =  document.getElementById("user-pw1").value;
		const proxyurl = "https://cors-anywhere.herokuapp.com/";
		const url = "https://login.roycea.repl.co/logmod.txt"; 
		let data = "";
		fetch(proxyurl + url)
		.then(response => response.text())
		.then((data) => {
			if(data.includes(email_a)) {
				//check password algorithm
				const proxyurl = "https://cors-anywhere.herokuapp.com/";
				let data = "";
				let url = "https://login.roycea.repl.co/logmod/" + email_a + ".txt";
				let searchItem = "PWD";
				let answer = "";
				 fetch(proxyurl + url)
				.then(response => response.text())
				.then((data) => {
					let start = data.indexOf(searchItem) + searchItem.length + 1;
					for(let z = start; z <= data.length; z++) {
						if(data[z] == "|") {
							break;
						} else {
							answer += data[z];
						}
					}
					if(answer == pwd_b) {
						localStorage.setItem("email", email_a);
						localStorage.setItem("name", "User");
						localStorage.setItem("img", "");
						 localStorage.setItem("logout", false);
						window.location.href = "dashboard.html";
					} else {
						alert("Incorrect Password");
					}
				});
			} else {
				alert("No account exists with that username")
			}
		});
	}
	  
	function register() {
		let email = document.getElementById("user-email").value;
		let pwd1 =  document.getElementById("user-pw").value;
		let pwd2 = document.getElementById("user-pw-repeat").value;
		if(email.includes("@")) {
			if(pwd1 == pwd2 & pwd1.length > 1) {
			//Ask some questions if necessary
			const proxyurl = "https://cors-anywhere.herokuapp.com/";
			const url = "https://login.roycea.repl.co/logmod.txt"; 
			let data = "";
			fetch(proxyurl + url)
			.then(response => response.text())
			.then((data) => {
				//check if file includes the email
				if(data.includes(email)) {
					alert("An account using that email is already in use!");
				} else {
					// Time to create it
					//We can add some optional questions if we want here, and process thru iframe
					document.getElementById("db").src = "https://login.roycea.repl.co/logmod.php?email=" + email + "&pwd=" + pwd1;
					alert("Your account was successfully created!");
					localStorage.setItem("email", email);
					localStorage.setItem("name", "User");
					localStorage.setItem("img", "");
					 localStorage.setItem("logout", false);
					window.location.href = "dashboard.html";
				}
			
			});
			} else {
				alert("Please fill out the password field properly!");
			}
		} else {
			alert("Fill out the email field properly.")
		}  
	}
      function onSignIn(googleUser) {
        // Useful data for your client-side scripts:
        var profile = googleUser.getBasicProfile();
        console.log("ID: " + profile.getId()); // Don't send this directly to your server!
        console.log('Full Name: ' + profile.getName());

        console.log('Given Name: ' + profile.getGivenName());
		localStorage.setItem("name", profile.getGivenName());
        console.log('Family Name: ' + profile.getFamilyName());
        console.log("Image URL: " + profile.getImageUrl());
		localStorage.setItem("img", profile.getImageUrl());
        console.log("Email: " + profile.getEmail());
		localStorage.setItem("email", profile.getEmail());
		const proxyurl = "https://cors-anywhere.herokuapp.com/";

		//BRUH DO WE NEED TO CREATE OUR OWN CORS-ANYWHERE SERVER -- ISSUE on GITHUB 
				const url = "https://login.roycea.repl.co/id.txt"; 
				fetch(proxyurl + url)
				.then(response => response.text())
				.then(data => check(data, profile.getId()));
      }
	  function check(data, id) {
		  if(data.includes(id)) {
			   localStorage.setItem("logout", false);
			  window.location.href = "dashboard.html";
		  } else {
			//Account does not exist
			//Ask some questions and stuff, then move on to gathering data and adding to the db 
			document.getElementById("db").src = "https://login.roycea.repl.co/index.php?id=" + id;
			 localStorage.setItem("logout", false);
			window.location.href = "dashboard.html";
		  }
	  }
	  
    </script>
	<iframe style="opacity:0;" id="db" src=""></iframe>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v5.0&appId=339518030566180&autoLogAppEvents=1"></script>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '339518030566180',
      cookie     : true,
      xfbml      : true,
      version    : 'v5.0',
    });
      
    FB.AppEvents.logPageView();   
 //     FB.getLoginStatus(function(response) {
 //   statusChangeCallback(response);
//});
  };

window.onload = function() {
	document.getElementById("db").src = "https://login.roycea.repl.co/";
}

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));


function statusChangeCallback(response){
	if(response.status === 'connected'){
		console.log('Logged in and Authenticated');
		testAPI();
	} else {
		console.log('Not authenticated');
	}
}
function checkLoginState() {
  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });
}

function testAPI() {
	FB.api('/me?fields=name,email,picture.width(150).height(150)', function(response){
		if(response && !response.error){
		   console.log(response);
			buildProfile(response);
		}
	})
}

function buildProfile(user) {
	let FBname = `${user.name}`;
	let FBemail = `${user.email}`;
	let ID = `${user.id}`;
	let FBimage = `${user.picture.data.url}`;   //this is the email -- we are not using it yet, but we will use it later
	var FirstName = "";
	for(let i=0; i<FBname.length; i++) {
		if(FBname[i] == " ") {
			break;
		} else {
			FirstName += FBname[i];
		}
	}
	localStorage.setItem("name", FirstName);
	localStorage.setItem("img", FBimage);
	localStorage.setItem("email", FBemail);
		const proxyurl = "https://cors-anywhere.herokuapp.com/";
				const url = "https://login.roycea.repl.co/id.txt"; 
				fetch(proxyurl + url)
				.then(response => response.text())
				.then(data => check(data, ID));

}
function logout() {

}
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<script id="rendered-js">
var LoginModalController = {
  tabsElementName: ".logmod__tabs li",
  tabElementName: ".logmod__tab",
  inputElementsName: ".logmod__form .input",
  hidePasswordName: ".hide-password",

  inputElements: null,
  tabsElement: null,
  tabElement: null,
  hidePassword: null,

  activeTab: null,
  tabSelection: 0, // 0 - first, 1 - second

  findElements: function () {
    var base = this;

    base.tabsElement = $(base.tabsElementName);
    base.tabElement = $(base.tabElementName);
    base.inputElements = $(base.inputElementsName);
    base.hidePassword = $(base.hidePasswordName);

    return base;
  },

  setState: function (state) {
    var base = this,
    elem = null;

    if (!state) {
      state = 0;
    }

    if (base.tabsElement) {
      elem = $(base.tabsElement[state]);
      elem.addClass("current");
      $("." + elem.attr("data-tabtar")).addClass("show");
    }

    return base;
  },

  getActiveTab: function () {
    var base = this;

    base.tabsElement.each(function (i, el) {
      if ($(el).hasClass("current")) {
        base.activeTab = $(el);
      }
    });

    return base;
  },

  addClickEvents: function () {
    var base = this;

    base.hidePassword.on("click", function (e) {
      var $this = $(this),
      $pwInput = $this.prev("input");

      if ($pwInput.attr("type") == "password") {
        $pwInput.attr("type", "text");
        $this.text("Hide");
      } else {
        $pwInput.attr("type", "password");
        $this.text("Show");
      }
    });

    base.tabsElement.on("click", function (e) {
      var targetTab = $(this).attr("data-tabtar");

      e.preventDefault();
      base.activeTab.removeClass("current");
      base.activeTab = $(this);
      base.activeTab.addClass("current");

      base.tabElement.each(function (i, el) {
        el = $(el);
        el.removeClass("show");
        if (el.hasClass(targetTab)) {
          el.addClass("show");
        }
      });
    });

    base.inputElements.find("label").on("click", function (e) {
      var $this = $(this),
      $input = $this.next("input");

      $input.focus();
    });

    return base;
  },

  initialize: function () {
    var base = this;

    base.findElements().setState().getActiveTab().addClickEvents();
  } };


$(document).ready(function () {
  LoginModalController.initialize();
});

    </script>
</body>
</html>
